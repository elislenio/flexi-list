/*! flexy-list 2015-08-08 */
"use strict";var flexiList=angular.module("flexiList",[]);flexiList.factory("flexiListService",["$log","$filter",function(a,b){return{sortDataset:function(a,c){var d=[];if(c[0]){var e="desc"==c[0].type;d=b("orderBy")(a,c[0].field,e)}else d=a;return d},filterDataset:function(c,d){var e,f,g,h,i,j,k=[];if(d.length)for(var l=0;l<c.length;l++){j=!0;for(var m=0;m<d.length;m++){e=d[m].field,f=c[l][e],g=d[m].condition,h=d[m].value,i=d[m].option;try{j=b(g)(f,h,i)}catch(n){a.log(options.logid+" - flexiListService: filter exception at ",n),j=!0}if(!j)break}j&&k.push(c[l])}else k=c;return k},limitDataset:function(a,b){if(!b)return a;var c=[],d=b;d>a.length&&(d=a.length);for(var e=0;d>e;e++)c.push(a[e]);return c},processDataset:function(a,b,c,d){var e=this.filterDataset(a,b),f=this.sortDataset(e,c),g=this.limitDataset(f,d);return g},pageDataset:function(a,b,c){var d=[],e=b+c;e>a.length&&(e=a.length);for(var f=b;e>f;f++)d.push(a[f]);return d},getPagination:function(a,b,c,d){var e={},f=b/c+1,g=Math.ceil(a/c),h=f-2;1>h&&(h=1);var i=h+d-1,j=i-g;j>0&&(i=g,h-=j,1>h&&(h=1));var k=(f-1)*c+1,l=f*c;l>a&&(l=a);for(var m=[],n=h;i>=n;n++)m.push(n);return e.firstrec=k,e.lastrec=l,e.rowcount=a,e.currpage=f,e.lastpage=i,e.pages=m,e.totalpages=g,e.show_pages=d,e.pagesize=c,e}}}]),flexiList.controller("flMainCtrl",["$scope","$log","$q","$http","flexiListService",function(a,b,c,d,e){function f(){return a.list?(angular.extend(v,a.list.options),a.$on("loadData",function(a,b){angular.extend(v,b),t()}),a.list.selectEnabled=function(){return v.selectable},a.list.paginationEnabled=function(){return v.pagination&&x.length>0?!0:!1},a.list.sortEnabled=function(a){return v.sortable?a?0==a.sortable?!1:!0:v.sortable:!1},a.list.getRecords=function(){return x},a.list.noResults=function(){return 0==x.length&&w},a.list.notEmpty=function(){return x.length>0?!0:!1},v.sortable&&g(),v.pagination&&m(),v.selectable&&j(),void(v.autoLoad&&t())):void b.log(v.logid+" - undefined scope.")}function g(){A=i(),a.list.isSortedAsc=function(a){return A?"asc"==A[a]:!1},a.list.isSortedDesc=function(a){return A?"desc"==A[a]:!1}}function h(a){v.orderby=a,A=i()}function i(){if(v.orderby){for(var a={},b=0;b<v.orderby.length;b++)a[v.orderby[b].field]=v.orderby[b].type;return a}}function j(){a.list.isRowSelected=function(a){return a.flSelected?!0:!1},a.list.rowToggleSelect=function(a){a.readonly||(a.flSelected?l(a):k(a))},v.multiselect&&(a.list.selectAll=function(){x&&(D=!D,C=0,angular.forEach(x,function(a){a.readonly||(D?k(a):l(a))}),D||(C=0))}),a.list.getSelectedCount=function(){return C},a.list.getSelectedRows=function(){var a=[];return x&&angular.forEach(x,function(b){b.flSelected&&a.push(b)}),a}}function k(a){v.multiselect?(a.flSelected=!0,C++):(B&&(B.flSelected=!1),a.flSelected=!0,B=a,C=1)}function l(a){v.multiselect?(a.flSelected=!1,C--):(B=!1,a.flSelected=!1,C=0)}function m(){a.list.pagination_info={},a.$on("getPage",function(a,b){n(b)}),a.list.setPageSize=function(a){v.pagesize=a,n(1)}}function n(b){1>b||b>a.list.pagination_info.totalpages||(y=(b-1)*v.pagesize,v.paginationOnClient?(x=e.pageDataset(z,y,v.pagesize),a.list.pagination_info=e.getPagination(u,y,v.pagesize,v.pages)):t())}function o(){var a=c.defer(),b={};return b.limited=0,b.where=v.where,b.orderby=v.orderby,v.limit?(b.limit=v.limit,b.limited=1,b.offset=0):v.pagination&&!v.paginationOnClient&&(b.limit=v.pagesize,b.offset=y),v.urlencoded?"GET"==v.method?d({method:"GET",url:v.listURL+"?"+jQuery.param(b)}).success(function(b,c){a.resolve(b)}).error(function(b,c){a.reject("ERROR: "+c)}):d({method:"POST",url:v.listURL,data:jQuery.param(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b,c){a.resolve(b)}).error(function(b,c){a.reject("ERROR: "+c)}):"GET"==v.method?d({method:"GET",url:v.listURL,params:b}).success(function(b,c){a.resolve(b)}).error(function(b,c){a.reject("ERROR: "+c)}):d.post(v.listURL,b).success(function(b,c){a.resolve(b)}).error(function(b,c){a.reject("ERROR: "+c)}),a.promise}function p(){var a=c.defer();return d({method:"GET",url:v.jsonFile}).success(function(b,c){a.resolve(b)}).error(function(b,c){a.reject("ERROR: "+c)}),a.promise}function q(){v.paginationOnClient=!0,w=!0,z=e.processDataset(v.data,v.where,v.orderby,v.limit),u=z.length,v.pagination?(x=e.pageDataset(z,y,v.pagesize),a.list.pagination_info=e.getPagination(u,y,v.pagesize,v.pages)):x=z,v.onRecordsLoaded&&v.onRecordsLoaded(x)}function r(){v.paginationOnClient=!0;var c=p();c.then(function(b){w=!0,z=e.processDataset(b,v.where,v.orderby,v.limit),u=z.length,v.pagination?(x=e.pageDataset(z,y,v.pagesize),a.list.pagination_info=e.getPagination(u,y,v.pagesize,v.pages)):x=z,v.onRecordsLoaded&&v.onRecordsLoaded(x)},function(a){w=!0,x=[],b.log(v.logid+" - Load Error: "+a),v.onLoadError&&v.onLoadError({result:"ERROR",message:a})})}function s(){var c=o();c.then(function(c){w=!0,"ERROR"==c.result&&(b.log(v.logid+" - Load Error."),v.onLoadError&&v.onLoadError(c)),c.records||(c.records=[]),c.orderby&&h(c.orderby),u=c.rowcount,v.pagination?v.paginationOnClient?(z=c.records,x=e.pageDataset(z,y,v.pagesize),a.list.pagination_info=e.getPagination(u,y,v.pagesize,v.pages)):(z=[],x=c.records,a.list.pagination_info=e.getPagination(u,c.offset,v.pagesize,v.pages)):(z=[],x=c.records),v.onRecordsLoaded&&v.onRecordsLoaded(x)},function(a){w=!0,x=[],b.log(v.logid+" - Load Error: "+a),v.onLoadError&&v.onLoadError({result:"ERROR",message:a})})}function t(){v.overlayToggle&&v.overlayToggle(),v.data?q():v.jsonFile?r():v.listURL?s():b.log(v.logid+" - undefined data source."),v.overlayToggle&&v.overlayToggle()}var u,v={data:!1,jsonFile:!1,listURL:!1,autoLoad:!0,selectable:!0,multiselect:!0,limit:!1,where:[],sortable:!0,orderby:[],pagination:!0,paginationOnClient:!1,pagesize:10,pages:5,method:"GET",urlencoded:!0,onRecordsLoaded:!1,onLoadError:!1,overlayToggle:!1,logid:"FL"},w=!1,x=[],y=0;f();var z,A={},B=!1,C=0,D=!1}]),flexiList.directive("flMain",function(){return{restrict:"E",scope:{list:"="},controller:"flMainCtrl"}}),flexiList.directive("flFieldDisplay",function(){return{restrict:"E",link:function(a,b,c){a.list.displayField?a.list.displayField(a,b,c):b.html(c.value)}}}),flexiList.filter("eq",function(){return function(a,b,c){return c?a.toLowerCase()==b.toLowerCase():a==b}}),flexiList.filter("ne",function(){return function(a,b){return a!=b}}),flexiList.filter("gt",function(){return function(a,b){return a>b}}),flexiList.filter("ge",function(){return function(a,b){return a>=b}}),flexiList.filter("lt",function(){return function(a,b){return b>a}}),flexiList.filter("le",function(){return function(a,b){return b>=a}}),flexiList.filter("like_l",function(){return function(a,b,c){return c?-1!==a.toLowerCase().indexOf(b.toLowerCase(),a.length-b.length):-1!==a.indexOf(b,a.length-b.length)}}),flexiList.filter("like_r",function(){return function(a,b,c){return c?0===a.toLowerCase().indexOf(b.toLowerCase()):0===a.indexOf(b)}}),flexiList.filter("like_b",function(){return function(a,b,c){return c?-1!==a.toLowerCase().indexOf(b.toLowerCase()):-1!==a.indexOf(b)}}),flexiList.filter("is_null",function(){return function(a,b){return 0==a.toString().length}}),flexiList.filter("is_not_null",function(){return function(a,b){return a.toString().length>0}}),flexiList.filter("regexp",function(){return function(a,b,c){var d=new RegExp(b,c);return d.test(a)}});